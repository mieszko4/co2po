"use strict";angular.module("co2poApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ui.bootstrap","ngTouch","google.places"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("co2poApp").controller("MainCtrl",["$scope","$location","Vehicle","Firebase",function(a,b,c,d){a.showResult=!1,a.origin=void 0,a.destination=void 0,a.vehicle=void 0,a.processResult=function(b,c,d){a.showResult=!0,a.origin=b,a.destination=c,a.vehicle=d},a.minimumEmission=void 0,a.chosenEmission=void 0,a.processCo2s=function(b){a.minimumEmission=c.getMinimumCo2(b),a.chosenEmission=c.getChosenCo2(b,a.vehicle),angular.element("html, body").animate({scrollTop:angular.element("#search-result").offset().top},1e3)},a.startTrip=!1,a.distance=void 0,a.co2Saved=void 0,a.showQuestionare=!1,a.runTrip=function(){a.startTrip=!0,a.distance=a.chosenEmission.distance/1e3,a.co2Saved=a.chosenEmission.co2-a.minimumEmission.co2,angular.element("html, body").animate({scrollTop:angular.element("#start-trip").offset().top},2e3),a.showQuestionare=!0},a.yes=function(){d.saveDecision(a.chosenEmission,a.minimumEmission,!0),a.showQuestionare=!1},a.showShare=!1,a.no=function(){d.saveDecision(a.chosenEmission,a.minimumEmission,!1),a.showQuestionare=!1},a.again=function(){angular.element("html, body").animate({scrollTop:0},1e3)}}]),angular.module("co2poApp").directive("searcher",["Vehicle",function(a){return{templateUrl:"views/directives/searcher.html",scope:{processResult:"&"},restrict:"E",link:function(b){b.vehicles=a.vehicles,b.searchForm={origin:void 0,destination:void 0,vehicle:void 0},b.search=function(){return"undefined"==typeof b.searchForm.origin.geometry||"undefined"==typeof b.searchForm.destination.geometry||"undefined"==typeof b.searchForm.vehicle?!1:void b.processResult({origin:{lat:b.searchForm.origin.geometry.location.lat(),lng:b.searchForm.origin.geometry.location.lng()},destination:{lat:b.searchForm.destination.geometry.location.lat(),lng:b.searchForm.destination.geometry.location.lng()},vehicle:b.searchForm.vehicle})}}}}]),angular.module("co2poApp").factory("Vehicle",["volvoCo2",function(a){var b=[{name:"Car",type:"car"},{name:"Bus",type:"bus"},{name:"Train",type:"train-tram-subway"},{name:"Motorcycle",type:"motorcycle"},{name:"Airplane",type:"airplane"},{name:"Ferry",type:"ferry"}],c={vehicles:b,getEmission:function(a,b){var d=null;return angular.forEach(b,function(b){b.transportName===c.volvoMappings[a.type]&&(d=b)}),d},getMinimumCo2:function(a){var b=a[0];return angular.forEach(a,function(a){a.co2<b.co2&&(b=a)}),b},getChosenCo2:function(a,b){var c=null;return angular.forEach(a,function(a){(null===c||a.vehicle.type===b)&&(c=a)}),c},volvoMappings:{car:"Car, medium",bus:"Bus","train-tram-subway":"Train, Subway",motorcycle:"Two-wheeler",ferry:"Ferry",airplane:"Aircraft"},getCO2:function(d,e){return a.getEmission(d,e).then(function(a){var d=[];return angular.forEach(b,function(b){var e=c.getEmission(b,a);d.push({vehicle:b,co2:e.totalCo2,distance:e.routedDistance})}),d})}};return c}]),angular.module("co2poApp").directive("statistics",["Vehicle",function(a){return{scope:{origin:"=",destination:"=",processCo2s:"&",once:"@"},templateUrl:"views/directives/statistics.html",restrict:"E",link:function(b){var c=function(){"undefined"==typeof b.origin&&(b.origin={lat:45.374546,lng:15.017002}),"undefined"==typeof b.destination&&(b.destination={lat:45.815123,lng:15.981682}),b.maxCO2=void 0,b.distance=void 0,a.getCO2(b.origin,b.destination).then(function(a){b.co2s=a,b.maxCO2=0,angular.forEach(b.co2s,function(a){a.co2>b.maxCO2&&(b.maxCO2=a.co2,b.distance=Math.round(a.distance/1e3))}),b.processCo2s({co2s:a})})};b.once?c():b.$watchCollection("[origin, destination]",function(){c()})}}}]),angular.module("co2poApp").directive("randomFact",["randomFact","$window",function(a,b){return{scope:{term:"@",triggerOnScroll:"@",savedCo2:"@"},templateUrl:"views/directives/random-fact.html",restrict:"E",link:function(c,d){if(a.getFact(c.term,c.savedCo2).then(function(a){c.fact=a}),c.triggerOnScroll){var e=!1,f=function(){var a=g.scrollTop()+3*g.height()/4;a>d.offset().top&&(d.removeClass("not-active"),e=!0)},g=angular.element(b);g.on("scroll",function(){e||f()}),f()}}}}]),angular.module("co2poApp").factory("randomFact",["$resource","$q","$interpolate",function(a,b,c){var d="https://www.googleapis.com/freebase/v1/",e=[{text:"You will save <strong>{{0.024 *savedCo2 | number:2}}</strong> trees",image:"images/path_icons/treese.png"},{text:"You will save <strong>{{0.435 * savedCo2 | number:2}}</strong> liters of petrol",image:"images/path_icons/petrol.png"},{text:"You will reduce carbon emission equivalent of eating <strong>{{2025 * savedCo2 | number:2}}</strong> kilos of steak per year",image:"images/path_icons/steak.png"},{text:"You will reduce carbon emission equivalent of <strong>{{2.4 * savedCo2 | number:2}}</strong> dollars of clothes",image:"images/path_icons/clothes.png"},{text:"By spending 2 hours per week between the sheets you annualy save <strong>900</strong> kg of CO<sub>2</sub>. Make love not CO<sub>2</sub> &lt;3",image:"images/path_icons/kissing.png"},{text:"Sea level rose <strong>17</strong> centimeters over the last century",image:"images/path_icons/ship.png"},{text:"Greenland and Antarctica are losing <strong>500</strong> cubic kilometers of ice per year",image:"images/path_icons/ice.png"}],f=0,g={getFact:function(g,h){if(h>0&&f<e.length){var i=b.defer(),j=e[f];return f++,j={text:c(j.text)({savedCo2:h/1e3}),image:j.image},i.resolve(j),i.promise}var k=a(d+"mqlread");return k.get({query:JSON.stringify([{id:null,name:null,"name~=":g,"/common/topic/article":[{text:null}]}])}).$promise.then(function(b){if(b.result.length>0){var c=Math.floor(Math.random()*b.result.length),e=b.result[c].id,f={},g=a(d+"topic"+e);return g.get({lang:"en",limit:"1"}).$promise.then(function(a){return f.text=a.property["/common/topic/article"].values[0].text,f})}})}};return g}]),angular.module("co2poApp").factory("volvoCo2",["$resource",function(a){var b="//api.commutegreener.com/api/co2/emissions",c={getEmission:function(c,d){var e=a(b,{callback:"JSON_CALLBACK",format:"json"},{get:{method:"JSONP",isArray:!1}});return e.get({startLat:c.lat,startLng:c.lng,endLat:d.lat,endLng:d.lng}).$promise.then(function(a){return a.emissions})}};return c}]),angular.module("co2poApp").directive("trip",["$window","$compile",function(a,b){var c=300,d=200,e={},f=["global warming","carbon dioxide","ocean acidification","glacial retreat","climate change"],g={car:"rgba(7, 71, 102, 0.60)",bus:"rgba(7, 71, 102, 0.60)","train-tram-subway":"rgba(7, 71, 102, 0.60)",motorcycle:"rgba(7, 71, 102, 0.60)",airplane:"rgba(149, 212, 222, 0.72)",ferry:"rgba(149, 212, 222, 0.72)"};return{scope:{distance:"@",vehicleType:"@",lineColor:"@",savedCo2:"@"},templateUrl:"views/directives/trip.html",restrict:"E",link:function(h,i){var j=Math.floor(h.distance/100)+7;j=20>j?j:20,h.height=(2+j)*d,i.height(h.height);var k=angular.element('<canvas id="trip-canvas" />')[0];i.find(".trip-path-wrapper").append(k),k.height=h.height,k.width=c;var l=k.getContext("2d");l.lineWidth=10,l.strokeStyle=g[h.vehicleType]||h.lineColor;var m=function(a){a.beginPath();var e=c/2,g=0,k=c/2+Math.random()*c/2,l=d/2,m=c/2-Math.random()*c/2,o=d/2+10,p=c/4+Math.random()*c/2,q=d;a.beginPath(),a.moveTo(e,g),a.bezierCurveTo(k,l,m,o,p,q),n(e,g,k,l,m,o,p,q),a.stroke();for(var r=0;j>r;r++){a.beginPath(),e=p,g=q,a.moveTo(e,g),k=p+(p-m),l=q+(q-o),m=c/2-Math.random()*c/2,p=c/4+Math.random()*c/2,o+=d,q+=d,a.bezierCurveTo(k,l,m,o,p,q),n(e,g,k,l,m,o,p,q),a.stroke();var s=Math.ceil(Math.random()*f.length),t=b('<random-fact saved-co2="'+h.savedCo2+'" class="not-active" trigger-on-scroll="true" term="'+f[s]+'"></random-fact>')(h);t.css({top:g}),t.addClass(r%2===0?"left":"right"),i.append(t)}a.beginPath(),e=p,g=q,a.moveTo(e,g),k=p+(p-m),l=q+(q-o),m=c/2-Math.random()*c/2,p=c/2,o+=d,q+=d,a.bezierCurveTo(k,l,m,o,p,q),n(e,g,k,l,m,o,p,q),a.stroke()},n=function(a,b,c,f,g,h,i,j){for(var k=0;1>=k;k+=d/1e5){var l=Math.pow(1-k,3)*a+3*Math.pow(1-k,2)*k*c+3*(1-k)*Math.pow(k,2)*g+Math.pow(k,3)*i,m=Math.pow(1-k,3)*b+3*Math.pow(1-k,2)*k*f+3*(1-k)*Math.pow(k,2)*h+Math.pow(k,3)*j;e[Math.round(m)]=l}};m(l),h.currentDistance=void 0,h.y=void 0;var o=angular.element(a),p=i.find(".vehicle"),q=i.find(".distance"),r=function(){var a=o.scrollTop(),b=o.height(),d=b-i.offset().top;d-=Math.floor(b/4),0>=d+a?(h.y=0,q.hide()):d+a<h.height?(h.y=d+a,q.show()):(h.y=h.height,q.hide());var f;0===h.y||h.y===h.height?f=c/2:"undefined"!=typeof e[h.y]&&(f=e[h.y]),"undefined"!=typeof f&&p.css({top:h.y-p.outerHeight(!0)/2,left:f-p.outerWidth(!0)/2})};o.on("scroll",function(){r(),h.$apply(function(){h.currentDistance=Math.round(h.y/h.height*h.distance)})}),r()},replace:!0}}]),angular.module("co2poApp").directive("share",["$location","$sanitize","$window",function(a,b,c){return{scope:{minEmission:"=",chosenEmission:"="},templateUrl:"views/directives/share.html",restrict:"E",link:function(b){b.$watchCollection("[minEmission, chosenEmission, source, destination]",function(a,b,d){"undefined"!=typeof d.minEmission&&"undefined"!=typeof d.chosenEmission&&(d.text=d.chosenEmission.vehicle.type===d.minEmission.vehicle.type?"I am a real greener. I will travel with "+a[0].vehicle.type+" which emmits the smallest ammount of CO2 in the atmosfere. So cool <3":"If I take "+a[0].vehicle.name+" instead of "+a[1].vehicle.name+" I will emmit "+(d.chosenEmission.co2-d.minEmission.co2)+"g of CO2 less in the atmosfere! So cool <3",d.text=c.encodeURIComponent(d.text))},!0),b.link=a.absUrl()}}}]),angular.module("co2poApp").controller("AboutCtrl",["$scope",function(a){a.users=[{name:"Miłosz Chmura",image:""},{name:"Anamarija Mišmaš",image:""},{name:"Tea Pavić",image:""},{name:"Martina Petraš",image:""}],a.project={goal:"Motivate user in a fun way to use means of transport<br>that emits at least carbon dioxside in the athmosphere.",why:'Greenr was developed as part of <a target="_blank" href="https://koding.com/">Koding global virtual hackaton</a>'},a.koding={name:"Koding",hastag:"#koding",twitterLink:"https://twitter.com/koding",pageLink:"https://koding.com/"},a.hackaton={name:"Hackaton",hastag:"#hackaton",twitterLink:"https://twitter.com/hashtag/hackathon"},a.greenrGithub={name:"Greenr Github account",githubLink:"https://github.com/mieszko4/co2po"}}]),angular.module("co2poApp").factory("Firebase",["$window",function(a){if("undefined"!=typeof a.Firebase){var b=new a.Firebase("https://intense-torch-5763.firebaseio.com/decisions"),c=new a.Firebase("https://intense-torch-5763.firebaseio.com/countPeople"),d=new a.Firebase("https://intense-torch-5763.firebaseio.com/countCo2"),e=angular.element("#mind-changers");return e.show(),c.on("value",function(a){e.find(".count-people").html(a.val())}),d.on("value",function(a){e.find(".count-co2").html(a.val())}),{saveDecision:function(a,e,f){b.push({chosen:{distance:a.distance,co2:a.co2},minimum:{distance:e.distance,co2:e.co2},changedMind:f}),f&&(c.transaction(function(a){return(a||0)+1}),d.transaction(function(b){return(b||0)+(a.co2-e.co2)}))}}}}]);